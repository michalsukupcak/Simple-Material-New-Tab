<dom-module id="x-topsites">

  <!-- ------------------------------------------------------------------------------------------------------------- -->
  <!-- Template -->
  <template>
    <style>

      /* Element */
      :host {
        @apply(--layout-horizontal);
        @apply(--layout-wrap);
      }

      /* Separator */
      i {
        font-style: normal;
        margin: 0 12px;
      }

      strong {
        margin: 0 12px 0 0;
      }

      a {
        color: var(--primary-background-color);
        text-decoration: none;
      }
      a:hover {
        text-decoration: underline;
      }
      a:last-of-type i {
        display: none;
      }

      a span {
        max-width: 120px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      a i {

      }

    </style>

    <i>/</i>
    <strong>Most visited:</strong>
    <template is="dom-repeat" items="[[topSites]]" as="topSite">
      <a href="[[topSite.url]]"><span>[[topSite.title]]</span><i>|</i></a>
    </template>

  </template>

  <!-- ------------------------------------------------------------------------------------------------------------- -->
  <!-- Script -->
  <script>
    (function() {
      'use strict';
      Polymer({

        /**
         * Element
         */
        is: 'x-topsites',
        properties: {

          // List of top sites
          topSites: {
            type: Array,
            value: []
          },

          // Maximum number of top sites
          max: {
            type: Number,
            value: 8,
            observer: '_maxChanged'
          }

        },

        /**
         * Attached element lifecycle state - Loads all extensions and apps from chrome.management API, extracts
         * application data and sorts them into this.apps array.
         */
        attached: function () {
          this.topSites = [];
          chrome.topSites.get(function (array) {
            var topSitesCount = array.length;
            var i = 0;
            while (true) {
              if (i >= topSitesCount || i >= this.max) {
                break;
              }
              this.push('topSites', array[i]);
              i++;
            }
          }.bind(this));
        },

        _maxChanged: function () {
          this.attached();
        }

      });
    })();
  </script>
</dom-module>
